(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5992],{675992:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return K}});var r=n(798788),o=n(745680),i=n(552322),a=n(351253),l=n(323440),s=n(5693),c=n(695858),d=n(202784),u=n(829051),m=n(165846),g=n(223258),_=n(128680),h=n(586750),p=d.createContext({}),x=n(470865),f=n(996670),v=n(117029),y=n(8977),C=n.n(y),j=function(e){var t=e.value,n=e.title,r=e.existed,o=void 0===r?[]:r,s=e.onChange,c=e.onCancel,u=(0,d.useState)(t),m=u[0],g=u[1],h=(0,d.useState)(),p=h[0],x=h[1],f=(0,a.useThemeColors)();return(0,i.jsxs)(_.Modal,{className:C().editRoleModal,width:400,title:n,visible:!0,onOk:function(){m?m.length>50?x((0,l.t)(l.Strings.add_role_error_limit,{max:50})):o.some((function(e){return e===m}))?x((0,l.t)(l.Strings.add_role_error_exists)):(s&&s(m),c&&c()):x((0,l.t)(l.Strings.add_role_error_empty))},onCancel:c,centered:!0,children:[(0,i.jsx)(a.TextInput,{placeholder:(0,l.t)(l.Strings.role_name_input_placeholder),onChange:function(e){g(e.target.value),x("")},value:m,error:Boolean(p),block:!0}),(0,i.jsx)(a.Box,{position:"absolute",children:p&&(0,i.jsx)(a.Typography,{variant:"body4",color:f.textDangerDefault,children:p})})]})},b=function(e){var t=document.createElement("div");document.body.appendChild(t);var n=(0,v.createRoot)(t);n.render((0,i.jsx)(j,(0,f.Z)((0,x.Z)({},e),{onCancel:function(){n.unmount(),t.parentElement.removeChild(t)}})))},S=n(72779),M=n.n(S),I="ROLE_MENU_EDIT",R=function(e){var t=e.selected,n=e.role,r=e.icon,o=e.onEdit,l=e.onDelete,s=e.onClick,c=n.roleName,u=n.roleId,g=(0,d.useContext)(p).manageable&&(o||l),_=(0,a.useContextMenu)({id:I}).show;return(0,i.jsxs)("div",{className:M()(C().roleItem,t&&C().roleItemSelected),onClick:function(){return s&&s(u)},children:[r||(0,i.jsx)(m.UserGroupOutlined,{className:C().roleItemIcon,size:16}),(0,i.jsx)(a.Typography,{className:C().roleItemContent,ellipsis:!0,variant:"body3",children:c}),g&&(0,i.jsx)("div",{onClick:function(e){_(e,{roleName:c,role:n,onEdit:o,onDelete:l}),e.stopPropagation()},style:{display:"flex"},children:(0,i.jsx)(m.MoreStandOutlined,{className:C().roleItemIcon,size:16})})]})},T=n(178234),N=function(e){var t=e.roleList,n=e.refreshRoleList,r=e.activeRoleId,o=e.setActiveRoleId,s=(0,d.useContext)(p),c=s.manageable,u=s.setActiveRoleName,x=s.refreshMemberList,f=(0,d.useState)(""),v=f[0],y=f[1],j=(0,d.useMemo)((function(){return v?t.filter((function(e){return e.roleName.includes(v)})):[]}),[t,v]);(0,d.useEffect)((function(){var e,n=t.find((function(e){return e.roleId===r}));n?u&&u(n.roleName):o(null===(e=t[0])||void 0===e?void 0:e.roleId)}),[t,r,u,o]);var S=function(e,t){var r=e.roleId;t&&l.Api.updateOrgRole(r,t).then((function(e){var t=e.data;t.success?(n(),a.Message.success({content:(0,l.t)(l.Strings.rename_role_success_message)})):a.Message.error({content:t.message})}))},M=function(e){var t=e.roleId;l.Api.deleteOrgRole(t).then((function(e){var t=e.data;t.success||t.code!==l.StatusCode.DELETE_ROLE_EXIST_MEMBER?t.success?(n(),a.Message.success({content:(0,l.t)(l.Strings.delete_role_success_message)})):a.Message.error({content:t.message}):_.Modal.confirm({type:"warning",title:(0,l.t)(l.Strings.delete_role_warning_title),content:(0,l.t)(l.Strings.delete_role_warning_content),onOk:function(){return r&&x&&x(r)}})}))},N=t.map((function(e){return e.roleName})),L=[[{icon:(0,i.jsx)(m.EditOutlined,{}),text:(0,l.t)(l.Strings.role_context_item_rename),onClick:function(e){var t=e.onEdit,n=e.roleName,r=e.role;b({value:n,title:(0,l.t)(l.Strings.rename_role_title),onChange:function(e){return null===t||void 0===t?void 0:t(r,e)},existed:N})}},{icon:(0,i.jsx)(m.DeleteOutlined,{}),text:(0,l.t)(l.Strings.role_context_item_delete),onClick:function(e){var t=e.onDelete,n=e.role;null===t||void 0===t||t(n)}}]];return(0,i.jsxs)("div",{className:C().leftWrap,children:[(0,i.jsx)(g.Mj,{size:"small",keyword:v,change:y}),v?(0,i.jsx)(E,{activeRoleId:r,list:j,onClick:o}):(0,i.jsxs)(i.Fragment,{children:[c&&(0,i.jsx)(a.Button,{className:C().addButton,prefixIcon:(0,i.jsx)(m.AddOutlined,{}),color:"primary",size:"small",block:!0,onClick:function(){b({value:"",title:(0,l.t)(l.Strings.add_role_title),onChange:function(e){return function(e,t){e&&l.Api.createRole(e).then((function(e){var n=e.data;n.success?(t(),a.Message.success({content:(0,l.t)(l.Strings.add_role_success_message)})):a.Message.error({content:n.message})}))}(e,n)},existed:N})},children:(0,l.t)(l.Strings.add_role_btn)}),(0,i.jsx)("div",{className:C().leftList,children:(0,i.jsx)(h.$B,{style:{width:"100%",height:"100%"},children:t.map((function(e){return(0,i.jsx)(R,{role:e,onEdit:S,onDelete:M,onClick:o,selected:r===e.roleId},e.roleId)}))})}),(0,i.jsx)(a.ContextMenu,{overlay:(0,T.Dg)(L,!0),menuId:I})]})]})},E=function(e){var t=e.activeRoleId,n=e.list,r=e.onClick;return 0===n.length?(0,i.jsx)(g.hF,{}):(0,i.jsx)("div",{className:C().roleListSearchWrap,children:(0,i.jsx)(h.$B,{style:{width:"100%",height:"100%"},children:n.map((function(e,n){return(0,i.jsx)(R,{role:e,onClick:r,icon:(0,i.jsx)(g.qE,{id:e.roleId,title:e.roleName,size:g.DZ.Size32,type:g.fC.Team}),selected:t===e.roleId},n)}))})})},L=n(712765),k=n(219779),B=n(860644),w=function(e){var t=(0,a.useThemeColors)();return(0,i.jsxs)(a.Box,{display:"flex",alignItems:"center",children:[(0,i.jsxs)("div",{className:M()(C().unitItem,e.unitType===l.MemberType.Team&&C().unitItemTeam),children:[(0,i.jsx)(g.qE,{src:e.avatar,id:e.unitId,title:e.nickName||e.unitName||(0,l.t)(l.Strings.unnamed),avatarColor:e.avatarColor,size:g.DZ.Size20,type:e.unitType===l.MemberType.Member?g.fC.Member:g.fC.Team}),(0,i.jsx)(a.Typography,{className:C().unitName,variant:"body4",ellipsis:!0,children:e.unitName})]}),e.isAdmin&&(0,i.jsx)("div",{className:C().unitTag,children:(0,i.jsx)(a.Typography,{color:t.borderOnbrandDefault,variant:"body4",children:(0,l.t)(l.Strings.admin)})})]})},A={pageSize:10,page:1},O=function(e){var t,n,r=(0,a.useThemeColors)(),o=e.list,s=e.total,c=e.onChangePage,u=e.onRemove,m=e.openAddMemberModal,g=e.onBatchSelectMember,_=(0,d.useContext)(p).manageable,h=(0,d.useState)(A),f=h[0],v=h[1],y=f.page,j=f.pageSize,b=(0,d.useRef)(null),S=(0,d.useRef)(null),M=(0,d.useState)(0),I=M[0],R=M[1],T=(0,d.useCallback)((function(){var e,t,n=(null===S||void 0===S||null===(e=S.current)||void 0===e?void 0:e.clientHeight)||0,r=(null===(t=b.current)||void 0===t?void 0:t.clientHeight)||0;r>47&&R(r-47-n)}),[]);(0,d.useLayoutEffect)((function(){T()})),(0,d.useEffect)((function(){return window.addEventListener("resize",T),function(){window.removeEventListener("resize",T)}}),[T]);var N=[{key:"unitName",title:(0,l.t)(l.Strings.role_member_table_header_name),align:"left",width:27.6,render:function(e,t){return(0,i.jsx)(w,(0,x.Z)({},t))}},{dataIndex:"teams",key:"teams",title:(0,l.t)(l.Strings.role_member_table_header_team),align:"left",width:29.6,render:function(e,t){return(0,i.jsx)(a.Typography,{variant:"body3",children:t.teams||t.unitName})}}];_&&N.push({key:"operate",title:(0,l.t)(l.Strings.operation),align:"left",width:18,render:function(e,t){return(0,i.jsx)(a.LinkButton,{component:"span",underline:!1,color:r.textDangerDefault,onClick:function(){return u&&u([t.unitRefId])},children:(0,l.t)(l.Strings.delete_role_member_title)})}});var E=_?{columnWidth:4.8,onChange:function(e,t){g&&g(t.map((function(e){return e.unitRefId})))}}:void 0,L=s>0,O=null===(t=(0,l.getLanguage)().split("-"))||void 0===t||null===(n=t[0])||void 0===n?void 0:n.toLowerCase();return(0,i.jsx)("div",{className:C().roleTableWrap,children:(0,i.jsxs)(a.Box,{ref:b,display:"flex",height:"100%",flexDirection:"column",minWidth:480,children:[(0,i.jsx)(k.ZP,{renderEmpty:function(){return(0,i.jsx)(z,{wrapperHeight:I,addRole:m})},children:(0,i.jsx)(B.Z,{dataSource:o,columns:N,pagination:!1,rowKey:function(e){return String(e.unitId)},rowSelection:E,scroll:{y:I}})}),L&&(0,i.jsx)(a.Box,{ref:S,display:"flex",justifyContent:"flex-end",paddingTop:16,children:(0,i.jsx)(a.Pagination,{lang:O,current:y,total:s,pageSize:j,onChange:function(e,t){v({page:e,pageSize:t}),c(e,t)},showChangeSize:!0,showTotal:!0})})]})})},z=function(e){var t=e.wrapperHeight,n=e.addRole,r=(0,a.useThemeColors)(),o=(0,d.useContext)(p).manageable;return(0,i.jsxs)(a.Box,{display:"flex",alignItems:"center",justifyContent:"center",marginTop:"".concat(t/2,"px"),style:{transform:"translateY(-50%)"},children:[(0,i.jsx)(a.Typography,{color:r.textCommonTertiary,variant:"body2",children:(0,l.t)(l.Strings.role_member_table_empty)}),o&&(0,i.jsx)(a.LinkButton,{onClick:n,children:(0,l.t)(l.Strings.add_member)})]})},D=function(e){var t=(0,a.useThemeColors)(),n=e.roleName,r=e.count,o=e.buttonOpts,s=e.openAddMemberModal,c=e.onRemove,u=(0,d.useContext)(p).manageable;return(0,i.jsxs)(a.Space,{size:24,vertical:!0,align:"start",children:[(0,i.jsxs)(a.Box,{display:"flex",alignItems:"center",children:[(0,i.jsx)(a.Typography,{color:t.textCommonPrimary,variant:"h6",children:n||""}),(0,i.jsxs)(a.Typography,{color:t.textCommonTertiary,variant:"h6",children:["\uff08",(0,l.t)(l.Strings.role_item,{count:r||0}),"\uff09"]})]}),u&&(0,i.jsxs)(a.Space,{size:16,children:[(0,i.jsx)(a.Button,{size:"small",onClick:s,children:(0,l.t)(l.Strings.add_member_or_group)}),(0,i.jsx)(a.Button,{className:C().batchRemoveRoleButton,size:"small",variant:"jelly",disabled:null===o||void 0===o?void 0:o.disabledRemoveBtn,color:"danger",onClick:c,children:(0,l.t)(l.Strings.delete_role_member_title)})]})]})},P=function(e,t){var n=e.activeRoleId,r=(0,d.useContext)(p).activeRoleName,o=(0,d.useState)([]),s=o[0],c=o[1],u=(0,d.useState)(0),m=u[0],g=u[1],h=(0,d.useState)(),x=h[0],f=h[1],v=(0,d.useState)(),y=v[0],j=v[1],b=(0,d.useCallback)((function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A;l.Api.getRoleMemberList(e,{pageNo:t.page,pageSize:t.pageSize}).then((function(e){var t=e.data;if(t.success){var n=t.data,r=n.records,o=n.total;c(r),g(o)}else a.Message.error({content:t.message})}))}),[]);(0,d.useImperativeHandle)(t,(function(){return{refreshMemberList:b}})),(0,d.useEffect)((function(){n&&b(n)}),[n,b]);var S=function(){return f(!0)},M=function(e){0!==e.length&&_.Modal.confirm({type:"warning",title:(0,l.t)(l.Strings.delete_role_member_title),content:(0,l.t)(l.Strings.delete_role_member_content),onOk:function(){return function(e){0!==e.length&&l.Api.deleteRoleMember(n,e).then((function(e){var t=e.data,r=t.success,o=t.message;r?(a.Message.success({content:(0,l.t)(l.Strings.delete_role_member_success)}),b(n)):a.Message.error({content:o})}))}(e)}})};return(0,i.jsxs)("div",{className:C().rightWrap,children:[(0,i.jsx)(D,{count:m,buttonOpts:{disabledRemoveBtn:!Boolean(null===y||void 0===y?void 0:y.length)},roleName:r,openAddMemberModal:S,onRemove:function(){return M(y||[])}}),(0,i.jsx)(O,{list:s,total:m,onChangePage:function(e,t){return b(n,{page:e,pageSize:t})},openAddMemberModal:S,onRemove:M,onBatchSelectMember:j}),x&&(0,i.jsx)(L.Gh,{source:L.AU.TeamAddMember,disableIdList:s.map((function(e){return e.unitId})),onCancel:function(){return f(!1)},onSubmit:function(e){if(0!==e.length){var t=[];e.forEach((function(e){var n="teamId"in e;(n||"memberId"in e)&&t.push({id:n?e.teamId:e.memberId,type:n?l.MemberType.Team:l.MemberType.Member})})),l.Api.addRoleMember(n,t).then((function(e){var t=e.data,r=t.success,o=t.message;r?(a.Message.success({content:(0,l.t)(l.Strings.add_member_success)}),b(n)):a.Message.error({content:o})}))}},maskClosable:!0})]})},W=d.forwardRef(P),H=n(585421),Z=function(e){var t=(0,a.useThemeColors)(),n=(0,d.useContext)(p).manageable;return(0,i.jsx)(a.Box,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%",backgroundColor:t.bgCommonDefault,children:(0,i.jsxs)(a.Box,{width:480,children:[(0,i.jsx)(a.Box,{textAlign:"center",marginBottom:24,children:(0,i.jsx)("img",{width:320,height:228.57,src:(0,l.integrateCdnHost)(l.Settings.space_setting_role_empty_img.value),alt:"role"})}),(0,i.jsx)(a.Typography,{variant:"h5",align:"center",children:(0,l.t)(l.Strings.manage_role_empty_title)}),(0,i.jsx)(a.Box,{marginTop:"8px",children:(0,i.jsx)(a.Typography,{variant:"body2",children:(0,i.jsx)("span",{dangerouslySetInnerHTML:{__html:(0,l.t)(l.Strings.manage_role_empty_desc1,{url:(0,H.Sy)().SPACE_ROLE_HELP_URL})}})})}),(0,i.jsx)(a.Box,{borderRadius:"4px",backgroundColor:t.bgCommonLower,padding:"8px",marginTop:"8px",children:(0,i.jsx)(a.Typography,{variant:"body4",color:t.textCommonTertiary,children:(0,l.t)(l.Strings.manage_role_empty_desc2)})}),n&&(0,i.jsx)(a.Box,{width:240,margin:"24px auto 0",children:(0,i.jsx)(a.Button,{color:"primary",block:!0,onClick:e.onClick,children:(0,l.t)(l.Strings.manage_role_empty_btn)})})]})})},U=function(){var e=(0,a.useThemeColors)();return(0,i.jsxs)(a.Box,{padding:24,children:[(0,i.jsxs)(a.Box,{display:"flex",alignItems:"center",paddingBottom:"4px",children:[(0,i.jsx)(a.Typography,{variant:"h6",children:(0,l.t)(l.Strings.tab_role)}),(0,i.jsx)("a",{style:{display:"flex",alignItems:"center",marginLeft:"4px"},target:"_blank",href:(0,H.Sy)().SPACE_ROLE_HELP_URL,rel:"noreferrer",children:(0,i.jsx)(m.QuestionCircleOutlined,{color:e.textCommonTertiary,size:16})})]}),(0,i.jsx)(a.Typography,{variant:"body3",children:(0,i.jsx)("span",{dangerouslySetInnerHTML:{__html:(0,l.t)(l.Strings.manage_role_header_desc,{url:(0,H.Sy)().SPACE_ROLE_HELP_URL})}})})]})},G=n(589273),J=n.n(G),K=function(){var e,t=(0,d.useState)(),n=t[0],m=t[1],g=(0,d.useState)(),_=g[0],h=g[1],x=(0,d.useRef)(null),f=(0,u.useSelector)((function(e){var t;return null===(t=e.spacePermissionManage.spaceResource)||void 0===t?void 0:t.permissions.includes(l.ConfigConstant.PermissionCode.MANAGE_ROLE)})),v=(0,c.i)(),y=v.run,C=v.data,j=C.isOpen,b=C.roles,S=(0,d.useState)(!0),M=S[0],I=S[1];(0,s.Z)((0,r.Z)((function(){return(0,o.__generator)(this,(function(e){switch(e.label){case 0:return[4,y()];case 1:return e.sent(),I(!1),[2]}}))}))),(0,d.useEffect)((function(){j||m(void 0)}),[j]);return M?(0,i.jsx)(a.Loading,{}):(0,i.jsx)(p.Provider,{value:{manageable:f,activeRoleName:_,setActiveRoleName:h,refreshMemberList:null===(e=x.current)||void 0===e?void 0:e.refreshMemberList},children:j&&b?(0,i.jsxs)("div",{className:J().roleManage,children:[(0,i.jsx)(U,{}),(0,i.jsxs)("div",{className:J().roleManageContent,children:[(0,i.jsx)("div",{className:J().roleManageContentLeft,children:(0,i.jsx)(N,{activeRoleId:n,setActiveRoleId:m,roleList:b,refreshRoleList:y})}),(0,i.jsx)("div",{className:J().roleManageContentRight,children:n&&(0,i.jsx)(W,{ref:x,activeRoleId:n})})]})]}):(0,i.jsx)(Z,{onClick:function(){l.Api.initRoles().then((function(e){var t=e.data,n=t.success,r=t.message;n?y():a.Message.error({content:r})}))}})})}},8977:function(e){e.exports={antiEllipsis:"style_antiEllipsis__VAJYu",noSelect:"style_noSelect__iajrm",antSelectOptionCommon:"style_ant-select-option-common__qywiy",flexCenter:"style_flexCenter__fxDIl",inputErrorMsg:"style_inputErrorMsg__sNhsY",tree:"style_tree__M0b0z",lightTree:"style_lightTree__u1aGu",darkTree:"style_darkTree__vpBT3",leftWrap:"style_leftWrap__w7r_O",addButton:"style_addButton__WKUMO",leftList:"style_leftList__QKAmA",roleItem:"style_roleItem__nVjQQ",roleItemIcon:"style_roleItemIcon__H54In",roleItemContent:"style_roleItemContent__5gObC",roleItemSelected:"style_roleItemSelected__O7v9i",roleListSearchWrap:"style_roleListSearchWrap__GDc2E",roleItemMenu:"style_roleItemMenu__zLNbP",rightWrap:"style_rightWrap__dVoRT",roleTableWrap:"style_roleTableWrap__CFJJx",unitItem:"style_unitItem___J55r",unitName:"style_unitName__FU3pr",unitItemTeam:"style_unitItemTeam__mdCax",unitTag:"style_unitTag__LNGcw",editRoleModal:"style_editRoleModal__85MRu",batchRemoveRoleButton:"style_batchRemoveRoleButton__x8trz"}},589273:function(e){e.exports={roleManage:"style_roleManage__3HO1j",roleManageContent:"style_roleManageContent__Y1n5J",roleManageContentLeft:"style_roleManageContentLeft__mhKGQ",roleManageContentRight:"style_roleManageContentRight__EzOKu"}}}]);