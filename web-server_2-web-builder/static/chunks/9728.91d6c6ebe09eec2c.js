(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9728],{979728:function(e,t,n){"use strict";n.r(t);var i=n(798788),a=n(745680),s=n(552322),r=n(351253),o=n(323440),l=n(165846),c=n(5693),u=n(616652),d=n(148951),m=n(223258),v=n(773941),_=n(864453),f=n(178234),p=n(202784),h=n(829051),g=n(424614),N=n(737470),k=n(131148),y=n.n(k),C={cropDesc:(0,o.t)(o.Strings.support_image_formats_limits,{number:2})};t.default=function(){var e=(0,g.a)(),t=(0,r.useThemeColors)(),n=(0,p.useState)(!1),k=n[0],S=n[1],b=(0,h.useDispatch)(),x=(0,h.useSelector)((function(e){return e.user.err})),j=(0,h.useSelector)((function(e){return e.user.info})),E=(0,_.CL)(),w=E.getLoginStatusReq,I=E.customOrOfficialAvatarUpload,A=(0,_.QT)(w).loading,T=(0,_.QT)(I,{manual:!0}).run,z=e.get("inviteMailToken"),Z=e.get("inviteLinkToken"),B=e.get("nodeId"),H=e.get("suiteId"),M=e.get("defaultName")||"",O=e.get("sourceType")||"",F=(0,p.useState)(M),Q=F[0],V=F[1],D=(0,_.QT)((function(){return o.Api.loadOrSearch({unitIds:null===j||void 0===j?void 0:j.unitId})}),{onSuccess:function(e){var t=e.data.data[0];t.isActive||V(t.name)},onError:function(){},manual:!0}).run;(0,p.useEffect)((function(){(null===j||void 0===j?void 0:j.nickName)?V(j.nickName):V("wecomShop"===O?M:"")}),[null===j||void 0===j?void 0:j.nickName,O,M]),(0,p.useEffect)((function(){A||j||v.F.push(o.Navigation.HOME)}),[A]),(0,c.Z)((function(){b(o.StoreActions.setHomeErr(null)),H&&D()}));function G(){return L.apply(this,arguments)}function L(){return(L=(0,i.Z)((function(){var t,n,i,s,r,l,c,u,d;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:return(t=e.get("reference")||localStorage.getItem("reference"))&&(localStorage.removeItem("reference"),(0,f.HV)(window.location.href,t))?(window.location.href=t,[2]):z?[4,o.Api.inviteEmailVerify(z)]:[3,3];case 1:return n=a.sent(),i=n.data,s=i.success,r=i.data,s&&r?[4,o.Api.linkInviteEmail(null===r||void 0===r?void 0:r.spaceId,null===r||void 0===r?void 0:r.inviteEmail)]:[3,3];case 2:if(a.sent().data.success)return v.F.push(o.Navigation.WORKBENCH,{params:{spaceId:null===r||void 0===r?void 0:r.spaceId},clearQuery:!0}),[2];a.label=3;case 3:return Z&&B?[4,o.Api.linkValid(Z,B)]:[3,6];case 4:return l=a.sent(),c=l.data,u=c.success,d=c.data,u&&d?[4,o.Api.joinViaSpace(Z,B)]:[3,6];case 5:if(a.sent().data.success)return v.F.push(o.Navigation.WORKBENCH,{params:{spaceId:null===d||void 0===d?void 0:d.spaceId},clearQuery:!0}),[2];a.label=6;case 6:return v.F.push(o.Navigation.HOME),[2]}}))}))).apply(this,arguments)}var R=function(){var e=(0,i.Z)((function(){return(0,a.__generator)(this,(function(e){switch(e.label){case 0:return Q?[3,2]:[4,G()];case 1:return e.sent(),[2];case 2:return o.Api.updateUser({nickName:Q,init:!0}).then(function(){var e=(0,i.Z)((function(e){var t,n,i,s;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:return t=e.data,n=t.success,i=t.message,s=t.code,n?[4,G()]:[3,2];case 1:return a.sent(),[3,3];case 2:b(o.StoreActions.setHomeErr({code:s,msg:i})),a.label=3;case 3:return[2]}}))}));return function(t){return e.apply(this,arguments)}}()),[2]}}))}));return function(){return e.apply(this,arguments)}}();return A?null:(0,s.jsx)(m.im,{children:(0,s.jsxs)("div",{className:y().settingNickname,children:[(0,s.jsx)("div",{className:y().title,children:(0,o.t)(o.Strings.setting_nickname_title)}),(0,s.jsxs)(u.Z,{className:y().form,onFinish:R,children:[(0,s.jsxs)("div",{className:y().formContent,children:[(0,s.jsxs)("div",{className:y().avatarContainer,children:[(0,s.jsx)(m.qE,{id:(null===j||void 0===j?void 0:j.memberId)||"",src:null===j||void 0===j?void 0:j.avatar,title:(null===j||void 0===j?void 0:j.nickName)||"",size:m.DZ.Size80,className:y().avatorImg}),(0,s.jsx)(m.Xd,{className:y().editAvatarBtn,size:"x-small",shadow:!0,shape:"circle",icon:(0,s.jsx)(l.EditOutlined,{color:t.secondLevelText}),onClick:function(){return S(!0)}})]}),(0,s.jsxs)("div",{className:y().inputContainer,children:[(0,s.jsx)("div",{className:y().subTitle,children:(0,o.t)(o.Strings.setting_nickname_sub_title)}),(0,s.jsx)(d.Z,{className:x?"error":"",value:Q,placeholder:(0,o.t)(o.Strings.placeholder_input_nickname_with_rules,{minCount:1,maxCount:20}),ref:function(e){null!=e&&(e.focus(),Q.startsWith((0,o.t)(o.Strings.planet_dwellers))&&e.select())},onChange:function(e){x&&b(o.StoreActions.setHomeErr(null)),V(e.target.value)}})]})]}),(0,s.jsx)("div",{className:y().errorMsg,children:x?x.msg:""}),(0,s.jsx)(r.Button,{className:y().submit,onClick:R,color:"primary",size:"large",block:!0,children:(0,s.jsxs)("div",{className:y().button,children:[(0,s.jsx)(m.dy,{emoji:"airplane",size:18,set:"apple"}),(0,o.t)(o.Strings.button_come_on)]})})]}),(0,s.jsx)("div",{className:y().tip,children:(0,o.t)(o.Strings.change_nickname_tips)}),(0,s.jsx)(m.Sy,{type:m.pv.Avatar,avatarName:null===j||void 0===j?void 0:j.nickName,avatarColor:null===j||void 0===j?void 0:j.avatarColor,title:(0,o.t)(o.Strings.upload_avatar),confirm:function(e){return function(e){var t=e.officialToken,n=e.customFile;t?T({token:t}):n&&T({file:n})}(e)},visible:k,officialImgs:N.K,initPreview:function(e){if(j)return(0,s.jsx)(m.qE,{id:j.memberId,src:j.avatar,avatarColor:j.avatarColor,title:j.nickName,size:m.DZ.Size80,className:y().avatorImg,style:e})}({width:"100%",height:"100%"}),fileLimit:2,cancel:function(){S(!1)},customTips:C})]})})}},131148:function(e){e.exports={settingNickname:"style_settingNickname__a6UBX",title:"style_title__URtMa",formContent:"style_formContent__ZrVJu",avatarContainer:"style_avatarContainer__DoANJ",editAvatarBtn:"style_editAvatarBtn__veh8_",twinkle:"style_twinkle__hGpGV",inputContainer:"style_inputContainer__mmbjo",subTitle:"style_subTitle__hGiMZ",form:"style_form__CziCo",submit:"style_submit__0XG6z",button:"style_button__8ngzQ",errorMsg:"style_errorMsg__t5zmg",tip:"style_tip__SG6Bi"}}}]);